# Indexing reference genome
STAR --runThreadN 72 --runMode genomeGenerate --genomeDir ./STAR_genome_Trepens --genomeFastaFiles all_combined_raw.fa --limitGenomeGenerateRAM 33896294443 --genomeSAindexNbases 13

# Alignment of reference genome (without GTF)
STAR --runThreadN 20 --runMode genomeGenerate --genomeDir ./STAR_genome_Trepens --genomeFastaFiles all_combined_raw.fa 

# Unzipping RNA sequence fastq files (2 for Gr15 and 2 for P12; one forward and one reverse for each)
gzip -d /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-15-49-0-1_L1_ds.1144547961444886983822edfde76e82/AAC2MGKM5-7498-15-49-0-1_S15_L001_R1_001.fastq.gz
gzip -d /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-15-49-0-1_L1_ds.1144547961444886983822edfde76e82/AAC2MGKM5-7498-15-49-0-1_S15_L001_R2_001.fastq.gz
gzip -d /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-16-49-0-1_L1_ds.1144547961444886983822edfde76e82/AAC2MGKM5-7498-16-49-0-1_S15_L001_R1_001.fastq.gz
gzip -d /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-16-49-0-1_L1_ds.1144547961444886983822edfde76e82/AAC2MGKM5-7498-16-49-0-1_S15_L001_R2_001.fastq.gz


# Making a paired-trimmed fastq files from raw unzipped Gr15 fastq files
java -jar /usr/local/bin/trimmomatic.jar PE /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-15-49-0-1_L1_ds.1144547961444886983822edfde76e82/AAC2MGKM5-7498-15-49-0-1_S15_L001_R1_001.fastq /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-15-49-0-1_L1_ds.1144547961444886983822edfde76e82/AAC2MGKM5-7498-15-49-0-1_S15_L001_R2_001.fastq Gr_15_R1_Paired_trimmed.fq Gr_15_R1_Unpaired_trimmed.fq Gr_15_R2_Paired_trimmed.fq Gr_15_R2_Unpaired_trimmed.fq ILLUMINACLIP:adapters.fa:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36

# Making a paired-trimmed fastq files from raw unzipped P12 fastq files
java -jar /usr/local/bin/trimmomatic.jar PE /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-16-49-0-1_L1_ds.b2cf20113e3b499a98552db872ac7a6d/AAC2MGKM5-7498-16-49-0-1_S16_L001_R1_001.fastq /Volumes/archive/macknightlab/RNAseq_1_6_22/AAC2MGKM5-7498-16-49-0-1_L1_ds.b2cf20113e3b499a98552db872ac7a6d/AAC2MGKM5-7498-16-49-0-1_S16_L001_R2_001.fastq P_12_R1_Paired_trimmed.fq P_12_R1_Unpaired_trimmed.fq P_12_R2_Paired_trimmed.fq P_12_R2_Unpaired_trimmed.fq ILLUMINACLIP:adapters.fa:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36


# Making BAM files with the indexed reference sequence (run code when inside ref. genome dir; STAR_genome_Trepens) and the Gr_15_R1_Paired_trimmed.fq (--outFilterMultimapNmax parameter will count multimappers)
STAR --runThreadN 72 --g --readFilesIn Gr_15_R1_Paired_trimmed.fq Gr_15_R2_Paired_trimmed.fq --outFileNamePrefix Gr_15_mapped_multimap_adjusted_rd1 --outSAMtype BAM SortedByCoordinate --outFilterMultimapNmax 10
STAR --runThreadN 72 --g --readFilesIn P_12_R1_Paired_trimmed.fq P_12_R2_Paired_trimmed.fq --outFileNamePrefix P_12_mapped_multimap_adjusted_rd1 --outSAMtype BAM SortedByCoordinate --outFilterMultimapNmax 10



# Filter out duplicate sequences in a multi-fast containing all coding sequences of interest obtained from NCBI and Phytozome13 databases
awk '/^>/ { f = !a[$0]++ } f' Genes_from_phytozome_13_with_others_added.fa

# Normalise line length of multi-fasta annotation file 
ava -jar /usr/local/bin/picard.jar NormalizeFasta I=Documents/Phytozome_and_Constructed_GFF_genes_filtered_mod_headers.fa O= normalised_phytozome_and_Constructed_GFF_filtered_mod_headers.fa --LINE_LENGTH 80


# BLAT searching indexed reference genome (all_combined.fa is the indexed reference genome)
# Note: this outputs a txt file in GFF format, which was reformatted to GTF format in Microsoft Excel
blat STAR_genome_Trepens/all_combined.fa Documents/normalized_phytozome_and_Constructed_GFF_genes_filtered_mod_headers.fa Blat_output_attempt_one.txt

# Counting reads per locus in trial annotation file with HTSeq





# Counting reads per locus in trial annotation file with FeatureCounts
featureCounts -a Good_final_GTF_sacraficial.gtf -o featurecounts_Gr15_output_3rd_with_sortedByCoordBAM.txt --largestOverlap -t CDS -g gene_id /Volumes/archive/userdata/student_users/olivernewman/Gr_15_mappedAligned.sortedByCoord.out.bam -M --fraction
featureCounts -a Good_final_GTF_sacraficial.gtf -o featurecounts_P12_output_3rd_with_sortedByCoordBAM.txt --largestOverlap -t CDS -g gene_id /Volumes/archive/userdata/student_users/olivernewman/P_12_mappedAligned.sortedByCoord.out.bam -M --fraction





